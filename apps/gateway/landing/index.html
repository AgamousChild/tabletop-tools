<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tabletop Tools</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&display=swap');

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Geist', system-ui, -apple-system, sans-serif;
      font-size: 0.8125rem;
      background: #0f172a;
      color: #f1f5f9;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .accent { color: #fbbf24; }

    .subtitle {
      color: #94a3b8;
      font-size: 0.85rem;
      margin-bottom: 2rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 0.75rem;
      max-width: 960px;
      width: 100%;
    }

    a.card {
      display: block;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 0.5rem;
      padding: 1rem;
      text-decoration: none;
      color: #f1f5f9;
      transition: border-color 0.15s, transform 0.15s;
    }

    a.card:hover {
      border-color: #fbbf24;
      transform: translateY(-1px);
    }

    .card-title {
      font-size: 0.9375rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .card-desc {
      color: #94a3b8;
      font-size: 0.75rem;
      line-height: 1.4;
    }

    footer {
      margin-top: auto;
      padding-top: 2rem;
      color: #475569;
      font-size: 0.7rem;
    }
  </style>
</head>
<body>
  <h1>Tabletop <span class="accent">Tools</span></h1>
  <p class="subtitle">Tools for tabletop miniature wargamers</p>

  <div class="grid">
    <a class="card" href="/no-cheat/">
      <div class="card-title">No Cheat</div>
      <div class="card-desc">Detect loaded dice using computer vision and statistics. Point your camera, roll, and know.</div>
    </a>
    <a class="card" href="/versus/">
      <div class="card-title">Versus</div>
      <div class="card-desc">Simulate 40K combat. Pick two units, see the math: expected wounds, model kills, distributions.</div>
    </a>
    <a class="card" href="/list-builder/">
      <div class="card-title">List Builder</div>
      <div class="card-desc">Build army lists with live meta ratings from GT data. See what's winning before you build.</div>
    </a>
    <a class="card" href="/game-tracker/">
      <div class="card-title">Game Tracker</div>
      <div class="card-desc">Track matches turn by turn with photos, VP scoring, and unit losses. Your full game history.</div>
    </a>
    <a class="card" href="/tournament/">
      <div class="card-title">Tournament</div>
      <div class="card-desc">Run Swiss events: registration, pairings, results, live standings, and ELO ratings.</div>
    </a>
    <a class="card" href="/new-meta/">
      <div class="card-title">New Meta</div>
      <div class="card-desc">40K meta analytics: faction win rates, detachment stats, Glicko-2 player rankings.</div>
    </a>
    <a class="card" href="/data-import/">
      <div class="card-title">Data Import</div>
      <div class="card-desc">Load unit data from BSData into your browser. No account needed â€” data stays on your device.</div>
    </a>
    <a class="card" href="/admin/">
      <div class="card-title">Admin</div>
      <div class="card-desc">Platform dashboard: user counts, active sessions, app usage stats, and system health.</div>
    </a>
  </div>

  <div id="data-notice" style="max-width: 960px; width: 100%; margin-top: 2rem; padding: 1rem 1.5rem; background: #1e293b; border: 1px solid #334155; border-radius: 0.75rem; display: none;">
    <p id="data-notice-title" style="color: #fbbf24; font-weight: 600; margin-bottom: 0.25rem; font-size: 0.85rem;">Game data needed</p>
    <p id="data-notice-body" style="color: #94a3b8; font-size: 0.8rem; line-height: 1.5;">
      Import unit profiles and game rules to use Versus, List Builder, and Game Tracker.
      <a href="/data-import/" style="color: #fbbf24; text-decoration: underline;">Open Data Import</a>
    </p>
  </div>
  <script>
    (function() {
      var notice = document.getElementById('data-notice');
      var title = document.getElementById('data-notice-title');
      var body = document.getElementById('data-notice-body');

      function showNotice(t, b) {
        title.textContent = t;
        body.innerHTML = b;
        notice.style.display = 'block';
      }

      function showNeeded() {
        showNotice('Game data needed',
          'Import unit profiles and game rules to use Versus, List Builder, and Game Tracker. ' +
          '<a href="/data-import/" style="color:#fbbf24;text-decoration:underline">Open Data Import</a>');
      }

      function checkForUpdates(db) {
        // Read stored commitSha from importMeta
        if (!db.objectStoreNames.contains('meta')) { db.close(); return; }
        var tx = db.transaction('meta', 'readonly');
        var metaReq = tx.objectStore('meta').get('importMeta');
        metaReq.onsuccess = function() {
          db.close();
          var meta = metaReq.result;
          if (!meta || !meta.commitSha) return;
          // Check BSData latest commit
          fetch('https://api.github.com/repos/BSData/wh40k-10e/commits/main', {
            headers: { Accept: 'application/vnd.github.v3+json' }
          }).then(function(r) { return r.ok ? r.json() : null; })
            .then(function(data) {
              if (data && data.sha && data.sha !== meta.commitSha) {
                showNotice('Game data update available',
                  'BSData has been updated since your last import. ' +
                  '<a href="/data-import/" style="color:#fbbf24;text-decoration:underline">Reload Data</a>');
              }
            }).catch(function() {});
        };
        metaReq.onerror = function() { db.close(); };
      }

      try {
        var req = indexedDB.open('tabletop-tools-game-data', 7);
        req.onsuccess = function(e) {
          var db = e.target.result;
          if (!db.objectStoreNames.contains('units')) { showNeeded(); db.close(); return; }
          var tx = db.transaction('units', 'readonly');
          var count = tx.objectStore('units').count();
          count.onsuccess = function() {
            if (count.result === 0) { showNeeded(); db.close(); }
            else { checkForUpdates(db); }
          };
        };
        req.onerror = function() { showNeeded(); };
      } catch(e) {}
    })();
  </script>

  <footer>tabletop-tools.net <!--VERSION--></footer>
</body>
</html>
